# Generalized Attestation Request/Response specification

This is an attempt to create a general framework that encompasses many usecases for request/response interactions using JSON Web Tokens, including challenge/response authentication, selective disclosure, and requests for signatures.

## The `type` field in Request/Response

The `type` field is a “type” of request. It is specified by the following: authReq, shareReq, attReq, storeReq for requests, and authResp, shareResp, signResp for responses.

These are requests for authentication (challenge-response), requests to share certain attestations, requests for the user to sign specific unsigned attestations or other data, and a request for the user to store a specific attestation. In the shareReq and attReq types, we may also include a `challenge` field in order to pair the request with a challenge/response mechanism.

Each type has some companion fields, described below.

## Companion fields for `authReq`

`challenge`  A nonce randomly generated by the requestor.

`callback` (Optional) A URL specifying where to POST the response.

## Companion fields for `authResp`

`challenge` Return the same nonce as in the request

## Companion fields for `shareReq`

`requested` A list of requested attestations. Each entry in the list is of the form 

```javascript
{type: "physicalAddress", issuer: "0xabcdef"}. 
```

The requestor may chose to include only one of the above. If only `type` is specified the request is for all attestations of that type. If only `issuer` is specified the request is for all attestations from that issuer. If both are present you are requesting attestations of a specific type by a specific issuer.

`challenge` A nonce randomly generated by the requestor.
`callback` (Optional) A URL specifying where to POST the response.

## Companion fields for `shareResp`

`shared` A list of the attestation tokens that were requested.
`own` A map of user's own profile data that is returned.
`challenge` A nonce randomly generated by the requestor.

## Companion fields for `attReq`

`unsignedClaims` A list of unsigned claims that the user is requested to sign, in the form of JSON objects that form part of the payload of the attestation token, as described in  [uPort :: Off-Chain Attestations](./off-chain_attestations.md). A mandatory field is the `claim` itself, and a common field would be `sub` for the subject.

`challenge` A nonce randomly generated by the requestor.
`callback` (Optional) A URL specifying where to POST the signed tokens response.

## Companion fields for att`Resp`

`challenge` A nonce randomly generated by the requestor.
`signedClaims` A list of signed JWT.

## Companion fields for storeReq

`challenge` A nonce randomly generated by the requestor.
`toStore` A list of attestations to store.
`isPublic` A boolean that is `true` if the request is to store the data publicly.

## Companion fields for storeResp

`didStore` Boolean to communicate back if the attestation was stored or not
`challenge` A nonce randomly generated by the requestor.

## Note on `callback` URLs

The `callback` URL is optional in the above specification. The reason for this is to allow for P2P attestations. For instance, one user can initiate a signing request from their phone, share this request as a URL via an email or text message. The receiver can click on the URL which opens their uPort app. They can then sign the request and send the response back to the original user as a email or text message.

## Examples

These are the payload fields of the corresponding JSON Web Tokens for a few examples of request/response.

### Simple Challenge/Response

Request:

```javascript
{
    type: "authReq",
    iss: "0xabcdef",
    challenge: "0x34123471acad2312aff23",
    callback: "https://example.org/login"
}
```

Response:

```javascript
{
    type: "authResp",
    iss: "0x12345678",
    challenge: "0x34123471acad2312aff23"
}
```

### Selective Disclosure

Request:

```javascript
{
    type: "shareReq",
    iss: "0xabcdef",
    aud: "0x12345678",
    challenge: "0x34123471acad2312aff23",
    callback: "https://example.org/credentials",
    requested: [{"type": "name"}, {"type": "educationalDegree", "issuer": "0x9876ffee"}]
}
```

Response:

```javascript
{
    type: "shareResp",
    iss: "0x12345678",
    aud: "0xabcdef",
    challenge: "0x34123471acad2312aff23",
    own: {name: "Bob Smith"},
    shared: ["eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ",
            "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gSGVsbG8iLCJhZG1pbiI6dHJ1ZX0.wLbvoAfDHQ6_g24-OGVxKxgsd-jy4tusVSgC0QRzImJxNN-Ecgj63aHcFrzw0orhQ7vYjfSqfXxIzUbBhgitOyky68Urs2h8BPe-RiaDD8k-zZiXvl3MEiNEXwDvkGEhHorn4lojRWGBVEaWxUNFPoqrVLhHm8Z39y2nrlw8hb0"]
}
```

### Attestation signing requests

Request:

```javascript
{
    type: "attReq",
    iss: "0xabcdef",
    aud: "0x12345678",
    challenge: "0x34123471acad2312aff23",
    callback: "https://example.org/signedAttestations",
    unsignedClaims: [{"claim": {"key": "value"}, "sub": "0xaaabbb"}, {"claim": {"complexType": {"key1": "value1", "key2": "value2"}}}]
}
```

Response:

```javascript
{
    type: "attResp",
    iss: "0x12345678",
    aud: "0xabcdef",
    challenge: "0x34123471acad2312aff23",
    signedClaims: ["eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ",
            "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gSGVsbG8iLCJhZG1pbiI6dHJ1ZX0.wLbvoAfDHQ6_g24-OGVxKxgsd-jy4tusVSgC0QRzImJxNN-Ecgj63aHcFrzw0orhQ7vYjfSqfXxIzUbBhgitOyky68Urs2h8BPe-RiaDD8k-zZiXvl3MEiNEXwDvkGEhHorn4lojRWGBVEaWxUNFPoqrVLhHm8Z39y2nrlw8hb0"]
}
```

### Store attestations

Request:

```javascript
{
    type: "storeReq",
    iss: "0xabcdef",
    aud: "0x12345678",
    challenge: "0x34123471acad2312aff23",
    toStore: ["eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ"]
}
```

Response (Optional?):

```javascript
{
    type: "storeResp",
    iss: "0x12345678",
    aud: "0xabcdef",
    challenge: "0x34123471acad2312aff23",
    didStore : true
}
```
